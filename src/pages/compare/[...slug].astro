---
import Layout from '../../layouts/Layout.astro';
import Header from '../../components/Header.astro';
import Footer from '../../components/Footer.astro';
import { getCollection } from 'astro:content';
import DealCard from '../../components/DealCard.astro';

export async function getStaticPaths() {
    const coupons = await getCollection('coupons');
    const deals = coupons.map(c => c.data);
    const paths = [];
    const firms = [...new Set(deals.map(d => d.firm_name))];
    
    // Generate pairs
    for (let i = 0; i < firms.length; i++) {
        for (let j = i + 1; j < firms.length; j++) {
            const firmA = firms[i];
            const firmB = firms[j];
            
            // Find the best deal for each firm (if multiple, pick first for now)
            const dealA = deals.find(d => d.firm_name === firmA);
            const dealB = deals.find(d => d.firm_name === firmB);
            
            if (!dealA || !dealB) continue;

            // Create slug: firm-a-vs-firm-b
            const slug = `${firmA.toLowerCase().replace(/\s+/g, '-')}-vs-${firmB.toLowerCase().replace(/\s+/g, '-')}`;
            
            paths.push({
                params: { slug },
                props: { dealA, dealB },
            });
        }
    }
    return paths;
}

const { dealA, dealB } = Astro.props;

const title = `${dealA.firm_name} vs ${dealB.firm_name}: Which Prop Firm is Better? (2025)`;
const description = `Compare ${dealA.firm_name} and ${dealB.firm_name} side-by-side. See who has the best discounts, rules, and payouts.`;
---

<Layout title={title} description={description}>
    <Header />
    <main class="min-h-screen pb-24">
        {/* Hero */}
        <div class="relative bg-brand-surface border-b border-white/5 py-20 px-4 mb-12 overflow-hidden">
            <div class="absolute inset-0 bg-brand-accent/5 blur-3xl opacity-30"></div>
            <div class="max-w-5xl mx-auto relative z-10 text-center">
                <h1 class="text-4xl md:text-6xl font-black mb-6 leading-tight tracking-tight text-white">
                    {dealA.firm_name} <span class="text-brand-accent text-2xl align-middle mx-2">VS</span> {dealB.firm_name}
                </h1>
                <p class="text-xl text-white/60 max-w-2xl mx-auto">
                    The ultimate showdown. We compare features, discounts, and rules to help you decide.
                </p>
            </div>
        </div>

        <div class="max-w-6xl mx-auto px-4">
            {/* Comparison Table */}
            <div class="grid md:grid-cols-2 gap-8 mb-16">
                {/* Firm A */}
                <div class="bg-brand-surface border border-white/10 rounded-3xl p-8 flex flex-col relative overflow-hidden group hover:border-brand-accent/30 transition-all">
                    <div class="absolute top-0 left-0 w-full h-1 bg-brand-accent"></div>
                    <h2 class="text-3xl font-bold mb-2">{dealA.firm_name}</h2>
                    <div class="text-brand-accent font-bold text-xl mb-6">{dealA.discount_highlight}</div>
                    
                    <div class="flex-grow space-y-4 mb-8">
                        <h3 class="text-sm font-semibold text-white/40 uppercase tracking-wider">Key Features</h3>
                        <ul class="space-y-3">
                            {dealA.features?.slice(0, 5).map(feature => (
                                <li class="flex items-start gap-3 text-white/80">
                                    <i class="fa-solid fa-check text-green-500 mt-1"></i>
                                    <span>{feature}</span>
                                </li>
                            ))}
                        </ul>
                    </div>
                    
                    <div class="mt-auto pt-6 border-t border-white/10">
                        <div class="flex items-center justify-between mb-4">
                            <span class="text-white/60">Coupon Code</span>
                            <code class="bg-white/10 px-3 py-1 rounded text-brand-accent font-mono font-bold">{dealA.coupon_code}</code>
                        </div>
                        <a href={`/go/${dealA.id}`} target="_blank" class="block w-full text-center bg-brand-accent text-black font-bold py-3 rounded-xl hover:bg-white transition-colors">
                            Get {dealA.firm_name} Deal
                        </a>
                    </div>
                </div>

                {/* Firm B */}
                <div class="bg-brand-surface border border-white/10 rounded-3xl p-8 flex flex-col relative overflow-hidden group hover:border-blue-500/30 transition-all">
                    <div class="absolute top-0 left-0 w-full h-1 bg-blue-500"></div>
                    <h2 class="text-3xl font-bold mb-2">{dealB.firm_name}</h2>
                    <div class="text-blue-500 font-bold text-xl mb-6">{dealB.discount_highlight}</div>
                    
                    <div class="flex-grow space-y-4 mb-8">
                        <h3 class="text-sm font-semibold text-white/40 uppercase tracking-wider">Key Features</h3>
                        <ul class="space-y-3">
                            {dealB.features?.slice(0, 5).map(feature => (
                                <li class="flex items-start gap-3 text-white/80">
                                    <i class="fa-solid fa-check text-blue-500 mt-1"></i>
                                    <span>{feature}</span>
                                </li>
                            ))}
                        </ul>
                    </div>
                    
                    <div class="mt-auto pt-6 border-t border-white/10">
                        <div class="flex items-center justify-between mb-4">
                            <span class="text-white/60">Coupon Code</span>
                            <code class="bg-white/10 px-3 py-1 rounded text-blue-400 font-mono font-bold">{dealB.coupon_code}</code>
                        </div>
                        <a href={`/go/${dealB.id}`} target="_blank" class="block w-full text-center bg-blue-600 text-white font-bold py-3 rounded-xl hover:bg-blue-500 transition-colors">
                            Get {dealB.firm_name} Deal
                        </a>
                    </div>
                </div>
            </div>

            {/* Verdict Section */}
            <div class="bg-white/5 border border-white/10 rounded-3xl p-8 md:p-12 text-center max-w-3xl mx-auto mb-16">
                <i class="fa-solid fa-scale-balanced text-5xl text-white/20 mb-6"></i>
                <h2 class="text-3xl font-bold mb-4">Our Verdict</h2>
                <p class="text-lg text-white/80 leading-relaxed">
                    Both <strong>{dealA.firm_name}</strong> and <strong>{dealB.firm_name}</strong> are excellent choices. 
                    If you are looking for <strong>{dealA.discount_highlight}</strong>, then {dealA.firm_name} is the way to go. 
                    However, if <strong>{dealB.discount_highlight}</strong> is more important to your strategy, check out {dealB.firm_name}.
                </p>
            </div>

            {/* Related Deals */}
            <div class="text-center">
                <h3 class="text-xl font-bold mb-6">Explore More Options</h3>
                <div class="flex flex-wrap justify-center gap-4">
                    <a href="/#feed" class="inline-flex items-center gap-2 px-6 py-3 rounded-full border border-white/10 hover:bg-white/10 transition-colors">
                        View All Deals <i class="fa-solid fa-arrow-right"></i>
                    </a>
                    <a href="/blog" class="inline-flex items-center gap-2 px-6 py-3 rounded-full border border-white/10 hover:bg-white/10 transition-colors">
                        Read Our Blog <i class="fa-solid fa-newspaper"></i>
                    </a>
                </div>
            </div>
        </div>
    </main>
    <Footer />
</Layout>
