---
interface Props {
  firm: {
    id: string;
    firm_name: string;
    firm_logo: string;
    description?: string;
    category: string;
    discount_highlight?: string;
    theme_color?: string;
    trust_score?: string;
    leverage?: string;
    platforms?: string[];
  };
  rank?: number;
}

const { firm, rank } = Astro.props;
const accentColor = firm.theme_color || '#FF2D55';
const firmInitial = firm.firm_name.charAt(0);
---

<a 
    href={`/${firm.category.toLowerCase()}/${firm.id}`}
    class="group relative block overflow-hidden rounded-[32px] border border-white/10 bg-black/40 backdrop-blur-md transition-all hover:border-white/20 hover:scale-[1.02] active:scale-[0.98]"
>
    {/* Inner Glow/Gradient */}
    <div class="absolute -inset-0.5 bg-gradient-to-br from-white/10 to-transparent opacity-50"></div>
    
    <div class="relative p-6">
        {/* Top Section: Rank & Badge */}
        <div class="mb-6 flex items-start justify-between">
            <div class="flex items-center gap-3">
                <div 
                    class="flex h-12 w-12 items-center justify-center rounded-2xl bg-gradient-to-br from-white/10 to-transparent border border-white/10 text-xl font-black text-white shadow-inner shadow-white/5"
                    style={`border-color: ${accentColor}40;`}
                >
                    {firmInitial}
                </div>
                <div>
                    <h3 class="text-lg font-black text-white leading-tight uppercase tracking-tight">
                        {firm.firm_name}
                    </h3>
                    <div class="flex items-center gap-2 mt-1">
                        <div class="h-1.5 w-1.5 rounded-full bg-green-500 animate-pulse"></div>
                        <span class="text-[10px] font-black uppercase tracking-widest text-white/40">
                            Verified Firm
                        </span>
                    </div>
                </div>
            </div>
            {rank && (
                <span class="text-[10px] font-black text-white/20 uppercase tracking-[0.2em]">
                    #{String(rank).padStart(2, '0')}
                </span>
            )}
        </div>

        {/* Description */}
        <p class="mb-6 text-xs leading-relaxed text-white/50 line-clamp-3 italic">
            "{firm.description || `Leading ${firm.category} prop firm offering competitive leverage and high profit splits for professional traders.`}"
        </p>

        {/* Stats Row */}
        <div class="grid grid-cols-2 gap-3 mb-6">
            <div class="rounded-2xl border border-white/5 bg-white/5 p-3">
                <div class="text-[9px] font-black text-white/20 uppercase tracking-widest mb-1">Leverage</div>
                <div class="text-sm font-bold text-white group-hover:text-brand-accent transition-colors">{firm.leverage || '1:100'}</div>
            </div>
            <div class="rounded-2xl border border-white/5 bg-white/5 p-3 flex flex-col justify-center">
                <div class="text-[9px] font-black text-white/20 uppercase tracking-widest mb-1">Trust Score</div>
                <div class="flex items-center gap-1.5">
                    <i class="fa-solid fa-star text-[10px] text-green-500"></i>
                    <div class="text-sm font-bold text-white group-hover:text-brand-accent transition-colors">{firm.trust_score || '4.5'}</div>
                </div>
            </div>
        </div>

        {/* Platforms */}
        {firm.platforms && firm.platforms.length > 0 && (
            <div class="mb-6">
                <div class="text-[9px] font-black text-white/20 uppercase tracking-widest mb-2">Platforms</div>
                <div class="flex flex-wrap gap-2">
                    {firm.platforms.slice(0, 3).map(platform => (
                        <span class="text-[9px] font-bold text-white/40 border border-white/10 rounded-lg px-2 py-1 bg-white/5">
                            {platform}
                        </span>
                    ))}
                    {firm.platforms.length > 3 && (
                        <span class="text-[9px] font-bold text-white/20 px-1 py-1">
                            +{firm.platforms.length - 3} more
                        </span>
                    )}
                </div>
            </div>
        )}

        {/* CTA Area */}
        <div class="flex items-center justify-between border-t border-white/5 pt-4">
            <span 
                class="text-[10px] font-black tracking-widest uppercase"
                style={`color: ${accentColor};`}
            >
                {firm.discount_highlight || 'EXCLUSIVE DEAL'}
            </span>
            <div class="flex items-center gap-1.5 text-[10px] font-black text-white/80 uppercase tracking-widest group-hover:gap-3 transition-all">
                Read Reviews
                <i class="fa-solid fa-arrow-right-long text-xs"></i>
            </div>
        </div>
    </div>

    {/* Hover Glow Effect */}
    <div 
        class="absolute inset-x-0 bottom-0 h-1 transition-all duration-500 group-hover:h-full group-hover:bg-gradient-to-t group-hover:from-white/5 group-hover:to-transparent pointer-events-none"
        style={`background-image: linear-gradient(to top, ${accentColor}10, transparent);`}
    ></div>
</a>
