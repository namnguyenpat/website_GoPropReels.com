---
interface Props {
  firm: {
    id: string;
    firm_name: string;
    firm_logo: string;
    description?: string;
    category: string;
    discount_highlight?: string;
    theme_color?: string;
    trust_score?: string;
    leverage?: string;
    platforms?: string[];
  };
  rank?: number;
}

const { firm, rank } = Astro.props;
const accentColor = firm.theme_color || '#FF2D55';
const firmInitial = firm.firm_name.charAt(0);
---

<a 
    href={`/${firm.category.toLowerCase()}/${firm.id}`}
    class="group relative block overflow-hidden rounded-[32px] border border-white/10 bg-black/40 backdrop-blur-md transition-all hover:border-white/20 hover:scale-[1.02] active:scale-[0.98]"
>
    {/* Inner Glow/Gradient */}
    <div class="absolute -inset-0.5 bg-gradient-to-br from-white/10 to-transparent opacity-50"></div>
    
    <div class="relative p-6">
        {/* Top Section: Rank & Badge */}
        <div class="mb-6 flex items-start justify-between">
            <div class="flex items-center gap-3">
                <div 
                    class="flex h-12 w-12 items-center justify-center rounded-2xl bg-gradient-to-br from-white/10 to-transparent border border-white/10 text-xl font-black text-white shadow-inner shadow-white/5"
                    style={`border-color: ${accentColor}40;`}
                >
                    {firmInitial}
                </div>
                <div>
                    <h3 class="text-lg font-black text-white leading-tight uppercase tracking-tight">
                        {firm.firm_name}
                    </h3>
                    <div class="flex items-center gap-2 mt-1">
                        <div class="h-1.5 w-1.5 rounded-full bg-green-500 animate-pulse"></div>
                        <span class="text-[10px] font-black uppercase tracking-widest text-white/40">
                            Verified Firm
                        </span>
                    </div>
                </div>
            </div>
            {rank && (
                <span class="text-[10px] font-black text-white/20 uppercase tracking-[0.2em]">
                    #{String(rank).padStart(2, '0')}
                </span>
            )}
        </div>

        {/* Description */}
        <p class="mb-6 text-xs leading-relaxed text-white/50 line-clamp-3 italic">
            "{firm.description || `Leading ${firm.category} prop firm offering competitive leverage and high profit splits for professional traders.`}"
        </p>

        {/* Trading Stats - PREMIUM GRID */}
        <div class="grid grid-cols-2 gap-3 mb-6">
            <div class="group/stat relative overflow-hidden rounded-2xl border border-white/5 bg-white/[0.03] p-4 transition-all hover:bg-white/[0.05] hover:border-brand-accent/30">
                <div class="text-[8px] font-black text-white/30 uppercase tracking-[0.2em] mb-1">Max Capital</div>
                <div class="text-lg font-black text-white group-hover:text-brand-accent transition-colors">$400,000</div>
                <div class="absolute -right-2 -bottom-2 h-8 w-8 rounded-full bg-brand-accent/5 blur-xl group-hover/stat:bg-brand-accent/20 transition-all"></div>
            </div>
            <div class="group/stat relative overflow-hidden rounded-2xl border border-white/5 bg-white/[0.03] p-4 transition-all hover:bg-white/[0.05] hover:border-brand-accent/30">
                <div class="text-[8px] font-black text-white/30 uppercase tracking-[0.2em] mb-1">Profit Split</div>
                <div class="text-lg font-black text-white group-hover:text-brand-accent transition-colors">Up to 90%</div>
                <div class="absolute -right-2 -bottom-2 h-8 w-8 rounded-full bg-brand-accent/5 blur-xl group-hover/stat:bg-brand-accent/20 transition-all"></div>
            </div>
        </div>

        {/* Dynamic Meta Info */}
        <div class="flex items-center justify-between mb-8 px-2">
            <div class="flex gap-4">
                <div class="flex flex-col">
                    <span class="text-[8px] font-black text-white/20 uppercase tracking-widest mb-0.5">Leverage</span>
                    <span class="text-[11px] font-bold text-white/70">{firm.leverage || '1:100'}</span>
                </div>
                <div class="h-6 w-px bg-white/5"></div>
                <div class="flex flex-col">
                    <span class="text-[8px] font-black text-white/20 uppercase tracking-widest mb-0.5">Trust Score</span>
                    <div class="flex items-center gap-1">
                        <i class="fa-solid fa-star text-[8px] text-green-500"></i>
                        <span class="text-[11px] font-bold text-white/70">{firm.trust_score || '4.5'}</span>
                    </div>
                </div>
            </div>
            
            {firm.platforms && firm.platforms.length > 0 && (
                <div class="flex -space-x-2">
                    {firm.platforms.slice(0, 3).map((p, i) => (
                        <div 
                            title={p}
                            class="flex h-6 w-6 items-center justify-center rounded-full border border-white/10 bg-black text-[7px] font-black text-white/40 ring-2 ring-black uppercase"
                            style={`z-index: ${10-i}`}
                        >
                            {p.charAt(0)}
                        </div>
                    ))}
                </div>
            )}
        </div>

        {/* CTA Area */}
        <div class="flex items-center justify-between border-t border-white/10 pt-5">
            <div class="flex flex-col">
                <span class="text-[8px] font-black text-white/20 uppercase tracking-widest mb-0.5 italic">Active Promo</span>
                <span 
                    class="text-[11px] font-black tracking-widest uppercase"
                    style={`color: ${accentColor};`}
                >
                    {firm.discount_highlight || 'EXCLUSIVE DEAL'}
                </span>
            </div>
            <div class="group/btn flex items-center gap-2 rounded-xl bg-white/5 border border-white/10 px-4 py-2 text-[10px] font-black text-white/80 uppercase tracking-widest hover:bg-white/10 hover:text-white transition-all">
                Insights
                <i class="fa-solid fa-chevron-right text-[8px] transition-transform group-hover/btn:translate-x-1"></i>
            </div>
        </div>
    </div>

    {/* Hover Glow Effect */}
    <div 
        class="absolute inset-0 opacity-0 group-hover:opacity-100 transition-opacity duration-700 pointer-events-none"
        style={`background: radial-gradient(circle at 50% 100%, ${accentColor}15 0%, transparent 70%);`}
    ></div>
</a>
